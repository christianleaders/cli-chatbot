<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background: #f5f5f7;
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* Chat container */
      #chat-container {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
      }

      .message {
        max-width: 70%;
        padding: 12px 16px;
        margin-bottom: 12px;
        border-radius: 14px;
        white-space: pre-wrap;
        line-height: 1.45;
        font-size: 16px;
      }

      .user {
        background: #007aff;
        color: white;
        align-self: flex-end;
        border-bottom-right-radius: 4px;
      }

      .assistant {
        background: #e8e8ed;
        color: #111;
        align-self: flex-start;
        border-bottom-left-radius: 4px;
      }

      /* Chat input bar */
      #input-bar {
        display: flex;
        padding: 14px;
        background: white;
        border-top: 1px solid #d2d2d7;
        gap: 10px;
      }

      /* Expanding textarea */
      #msg {
        flex: 1;
        padding: 12px 14px;
        border: 1px solid #c7c7cc;
        border-radius: 12px;
        resize: none;
        font-size: 16px;
        line-height: 1.4;
        max-height: 150px;
        overflow-y: auto;
      }

      #sendBtn {
        padding: 0 18px;
        background: #007aff;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
      }

      #sendBtn:hover {
        background: #0062cc;
      }
    </style>
  </head>

  <body>
    <div id="chat-container"></div>

    <div id="input-bar">
      <textarea id="msg" rows="1" placeholder="Messageâ€¦"></textarea>
      <button id="sendBtn" onclick="send()">Send</button>
    </div>

    <script>
      const msgBox = document.getElementById("msg");
      const chatContainer = document.getElementById("chat-container");

      // Auto-expand textarea
      msgBox.addEventListener("input", () => {
        msgBox.style.height = "auto";
        msgBox.style.height = msgBox.scrollHeight + "px";
      });

      function addMessage(text, sender) {
        const div = document.createElement("div");
        div.className = "message " + sender;
        div.textContent = text;
        chatContainer.appendChild(div);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      async function send() {
        const message = msgBox.value.trim();
        if (!message) return;

        // Show user bubble
        addMessage(message, "user");
        msgBox.value = "";
        msgBox.style.height = "40px";

        // Call backend
        const res = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message })
        });

        const data = await res.json();
        const reply = data.reply;

        // Show assistant bubble
        addMessage(reply, "assistant");
      }

      // Allow enter to send (shift+enter for newline)
      msgBox.addEventListener("keydown", function (e) {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          send();
        }
      });
    </script>
  </body>
</html>
